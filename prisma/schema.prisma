// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Category {
  id          Int       @id @default(autoincrement())
  name        String
  priority    Int       @default(0)
  mediaType   String?   @map("media_type") // "photo" or "video"
  mediaUrl    String?   @map("media_url")
  products    Product[]
  subcategories Subcategory[]
  
  @@map("categories")
}

model Subcategory {
  id         Int      @id @default(autoincrement())
  name       String
  categoryId Int      @map("category_id")
  category   Category @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  products   Product[]
  
  @@map("subcategories")
}

model Product {
  id                Int            @id @default(autoincrement())
  name              String
  description       String?
  price             Decimal        @db.Decimal(10, 2)
  oldPrice          Decimal?       @map("old_price") @db.Decimal(10, 2)
  discountPercentage Int?          @map("discount_percentage")
  priority          Int            @default(0)
  topSale           Boolean        @default(false) @map("top_sale")
  limitedEdition    Boolean        @default(false) @map("limited_edition")
  season            String[]       @default([])
  color             String?
  categoryId        Int?           @map("category_id")
  subcategoryId     Int?           @map("subcategory_id")
  fabricComposition String?        @map("fabric_composition")
  hasLining         Boolean        @default(false) @map("has_lining")
  liningDescription String?        @map("lining_description")
  createdAt         DateTime       @default(now()) @map("created_at")
  
  category          Category?      @relation(fields: [categoryId], references: [id], onDelete: SetNull)
  subcategory       Subcategory?   @relation(fields: [subcategoryId], references: [id], onDelete: SetNull)
  sizes             ProductSize[]
  media             ProductMedia[]
  colors            ProductColor[]
  orderItems        OrderItem[]
  
  @@map("products")
}

model ProductSize {
  id        Int     @id @default(autoincrement())
  productId Int     @map("product_id")
  size      String
  stock     Int     @default(0)
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  
  @@unique([productId, size])
  @@map("product_sizes")
}

model ProductMedia {
  id        Int     @id @default(autoincrement())
  productId Int     @map("product_id")
  type      String  // "photo" or "video"
  url       String
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  
  @@map("product_media")
}

model ProductColor {
  id        Int     @id @default(autoincrement())
  productId Int     @map("product_id")
  label     String
  hex       String?
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  
  @@map("product_colors")
}

model Order {
  id            Int         @id @default(autoincrement())
  customerName  String      @map("customer_name")
  phoneNumber   String      @map("phone_number")
  email         String?
  deliveryMethod String     @map("delivery_method")
  city          String
  postOffice    String      @map("post_office")
  comment       String?
  paymentType   String      @map("payment_type") // "prepay" or "full"
  invoiceId     String      @unique @map("invoice_id")
  paymentStatus String      @default("pending") @map("payment_status") // "pending" | "paid" | "canceled"
  status        String?     // Optional status field
  createdAt     DateTime    @default(now()) @map("created_at")
  
  items         OrderItem[]
  
  @@map("orders")
}

model OrderItem {
  id        Int     @id @default(autoincrement())
  orderId   Int     @map("order_id")
  productId Int     @map("product_id")
  size      String
  quantity  Int
  price     Decimal @db.Decimal(10, 2)
  color     String?
  
  order     Order   @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product   Product @relation(fields: [productId], references: [id], onDelete: Restrict)
  
  @@map("order_items")
}
